!function(){var e,t="signalr-connect",n="signalr-subscribe",r="signalr-send";function i(e){return new signalR.HubConnectionBuilder().withUrl(e).withAutomaticReconnect().build()}function o(t,n){var r=[];return e.hasAttribute(t,n)&&r.push(t),t.querySelectorAll("["+n+"], [data-"+n+"]").forEach(function(e){r.push(e)}),r}function a(t){return e.getClosestMatch(t,s)}function s(t){return null!=e.getInternalData(t).HubConnection}function g(e,t){if(e)for(var n=0;n<e.length;n++)t(e[n])}htmx.defineExtension("signalr",{init:function(t){e=t,void 0==htmx.createHubConnection&&(htmx.createHubConnection=i)},onEvent:function(i,s){var c=s.target??s.detail.elt;switch(i){case"htmx:beforeCleanupElement":var u=e.getInternalData(c);void 0!=u.HubConnection&&u.HubConnection.stop();return;case"htmx:beforeProcessNode":g(o(c,t),function(n){!function(n){if(e.bodyContains(n)){if(!signalR)return logError("SignalR object not found. Make sure to include SignalR script in the page scripts before this extension.");var r=e.getAttributeValue(n,t),i=htmx.createHubConnection(r);e.triggerEvent(n,"htmx:signalr:starting"),i.onreconnecting(function(t){e.triggerEvent(n,"htmx:signalr:reconnecting",{error:t})}),i.onreconnected(function(t){e.triggerEvent(n,"htmx:signalr:reconnected",{connectionId:t})}),i.onclose(function(t){e.triggerEvent(n,"htmx:signalr:close",{error:t})}),i.start().then(function(){e.triggerEvent(n,"htmx:signalr:start",{connectionId:i.connectionId})}).catch(function(t){e.triggerErrorEvent(n,"htmx:signalr:start-error",{message:t.message,errorType:t.errorType})}),e.getInternalData(n).HubConnection=i}}(n)}),g(o(c,n),function(t){!function(t){if(e.bodyContains(t)){if(!signalR)return logError("SignalR object not found. Make sure to include SignalR script in the page scripts before this extension.");var r=a(t);if(r){var i=e.getInternalData(r).HubConnection,o=e.getAttributeValue(t,n).split(",");for(let a=0;a<o.length;a++){var s=o[a].trim();i.on(s,function o(a){if(g=r,!e.bodyContains(g)&&(e.getInternalData(g).HubConnection.stop(),1))return void i.off(s,o);if(c=r,u=s,l=t,f=o,e.bodyContains(l)&&-1!=e.getAttributeValue(l,n).split(",").indexOf(u)||(e.getInternalData(c).HubConnection.off(u,f),!1)){var g,c,u,l,f,d={message:a,method:s,target:e.getTarget(t)};if(e.triggerEvent(t,"htmx:signalr:message",d)&&("object"==typeof d.message&&(d.message=JSON.stringify(d.message)),e.withExtensions(t,function(e){d.message=e.transformResponse(d.message,null,t)}),null!==d.message&&void 0!==d.message)){var h=e.getSwapSpecification(t);e.swap(d.target,d.message,h)}}})}}}}(t)}),g(o(c,r),function(t){!function(t){if(e.bodyContains(t)){if(!signalR)return logError("SignalR object not found. Make sure to include SignalR script in the page scripts before this extension.");var n,i,o,s=a(t);s&&(n=s,i=t,o=e.getInternalData(i),e.getTriggerSpecs(i).forEach(function(t){e.addTriggerHandler(i,t,o,function(t,o){var a=e.getInternalData(n).HubConnection,s=e.getAttributeValue(i,r),g=e.getHeaders(i,n),c=e.getInputValues(i,"post"),u=c.errors,l=Object.assign({},c.values),f=e.getExpressionVars(i),d=e.mergeObjects(l,f),h=e.filterValues(d,i);(h.HEADERS=g,u&&u.length>0)?e.triggerEvent(i,"htmx:validation:halted",u):e.triggerEvent(i,"htmx:signalr:beforeSend",{method:s,headers:g,allParameters:d,filteredParameters:h})&&(a.send(s,h),e.shouldCancel(o,i)&&o.preventDefault(),e.triggerEvent(i,"htmx:signalr:afterSend",{method:s,message:h}))})}))}}(t)})}}})}();