@using System.Web
@inject NavigationManager NavigationManager;

<div class="navbar bg-base-200/80 backdrop-blur-md sticky top-0 z-30">
    <div class="flex-none">
        <label for="drawer" aria-label="open sidebar" class="btn btn-circle btn-ghost mr-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </label>
    </div>
    <div class="flex-1 flex items-baseline gap-2">
        @if (ShowBrand)
        {
            <BrandLink></BrandLink>
        }
        <AppVersion />

        @* <ul class="menu menu-horizontal px-1 hidden lg:inline-flex"> *@
        @*     <li> *@
        @*         <NavLink href="seasons" Match="NavLinkMatch.All"> *@
        @*             Seasons *@
        @*         </NavLink> *@
        @*     </li> *@
        @*     <AuthorizeView Roles="@UserRole.Admin()"> *@
        @*         <li> *@
        @*             <NavLink href="admin"> *@
        @*                 Admin *@
        @*             </NavLink> *@
        @*         </li> *@
        @*     </AuthorizeView> *@
        @*     <AuthorizeView> *@
        @*         <li> *@
        @*             <NavLink href="user-feed-notifications"> *@
        @*                 Notifications *@
        @*             </NavLink> *@
        @*         </li> *@
        @*     </AuthorizeView> *@
        @*     <AuthorizeView> *@
        @*         <NotAuthorized> *@
        @*             <li> *@
        @*                 <NavLink href="@GetLoginPath()"> *@
        @*                     Login *@
        @*                 </NavLink> *@
        @*             </li> *@
        @*             <li> *@
        @*                 <NavLink href="register"> *@
        @*                     Register *@
        @*                 </NavLink> *@
        @*             </li> *@
        @*         </NotAuthorized> *@
        @*         <Authorized> *@
        @*             <li> *@
        @*                 <NavLink href="@GetLogoutPath()"> *@
        @*                     Logout *@
        @*                 </NavLink> *@
        @*             </li> *@
        @*         </Authorized> *@
        @*     </AuthorizeView> *@
        @* </ul> *@
    </div>
    <span id="page-indicator" class="loading loading-spinner loading-sm mx-1 htmx-indicator"></span>
    <HubStatus/>
    <AuthorizeView>
        <NotAuthorized>
            <NavLink href="@GetLoginPath()"
                     class="btn btn-md btn-circle mx-1"
                     aria-label="Login to your account"
                     title="Login">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"/>
                </svg>

            </NavLink>
        </NotAuthorized>
        <Authorized>
            <NavLink href="@GetLogoutPath()"
                     class="btn btn-md btn-circle mx-1"
                     aria-label="Logout from your account"
                     title="Logout">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15"/>
                </svg>

            </NavLink>
        </Authorized>
    </AuthorizeView>


    <ThemeSelector></ThemeSelector>

</div>

@code
{
    [Parameter] public bool ShowBrand { get; set; } = true;
    private const string? ReturnUrlKey = "returnUrl";

    private string GetLoginPath()
    {
        return GetWithReturn("login");
    }

    private string GetLogoutPath()
    {
        return GetWithReturn("logout");
    }

    private string GetWithReturn(string basePath)
    {
        var currentUri = new Uri(NavigationManager.Uri);
        var returnValue = HttpUtility.ParseQueryString(currentUri.Query).Get(ReturnUrlKey);
        var returnPath = !string.IsNullOrEmpty(returnValue) ? returnValue : currentUri.AbsolutePath;
        return $"{basePath}?returnUrl={HttpUtility.UrlEncode(returnPath)}";
    }
}