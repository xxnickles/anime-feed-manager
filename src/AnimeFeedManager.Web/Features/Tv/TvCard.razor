@using AnimeFeedManager.Features.Tv.Library.Queries
@using AnimeFeedManager.Web.Features.Tv.Controls

@if (Series is not null)
{
    <SeriesCard SeriesInfo="@Series.TvSeries.AsSeriesCard()" LoaderId="_loaderId">
        <CardControls>
            @switch (Series)
            {
                case Available:
                case AvailableForSubscription:
                    <Badge Text="Available" Type="StatusType.Success"></Badge>
                    break;
                case Subscribed:
                    <Badge Text="Subscribed" Type="StatusType.Primary"></Badge>
                    break;
                case Interested:
                    <Badge Text="Interested" Type="StatusType.Secondary"></Badge>
                    break;
                case Completed:
                    <Badge Text="Completed" Type="StatusType.Info"></Badge>
                    break;
                default:
                    <Badge Text="Not Available" Type="StatusType.Warning"></Badge>
                    break;
            }

            @if (Series.User is AuthenticatedUser)
            {
                @switch (Series)
                {
                    case AvailableForSubscription:
                        <ForSubscription Model="@GetSubscriptionModel(Series)"></ForSubscription>
                        break;
                    case Subscribed:
                        <ForSubscriptionRemoval Model="@GetSubscriptionModel(Series)"></ForSubscriptionRemoval>
                        break;
                    case AvailableForFuture:
                        <ForInterested Model="@GetInterestedModel(Series)"></ForInterested>
                        break;
                    case Interested:
                        <ForInterestedRemoval Model="@GetInterestedModel(Series)"></ForInterestedRemoval>
                        break;
                }
            }

        </CardControls>
    </SeriesCard>
}

@code {
    [Parameter, EditorRequired] public UserTvSeries? Series { get; set; }
    private readonly string _loaderId = IdHelpers.GetUniqueName("card-loader");

    private TvInterestedViewModel GetInterestedModel(UserTvSeries series)
    {
        return new TvInterestedViewModel
        {
            SeriesTitle = series.TvSeries.Title,
            AdminView = series.User is AdminUser,
            LoaderSelector = $"#{_loaderId}",
            SeriesId = series.TvSeries.Id,
            UserId = series.User is AuthenticatedUser au ? au.UserId : string.Empty
        };
    }

    private TvSubscriptionViewModel GetSubscriptionModel(UserTvSeries series)
    {
        return new TvSubscriptionViewModel
        {
            SeriesTitle = series.TvSeries.Title,
            AdminView = series.User is AdminUser,
            LoaderSelector = $"#{_loaderId}",
            SeriesId = series.TvSeries.Id,
            UserId = series.User is AuthenticatedUser au ? au.UserId : string.Empty,
            SeriesFeedTitle = series.TvSeries.FeedTitle ?? string.Empty
        };
    }

}