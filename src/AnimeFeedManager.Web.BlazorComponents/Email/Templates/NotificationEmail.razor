@implements AnimeFeedManager.Web.BlazorComponents.IRenderableComponent<NotificationModel>
@* Email notification for new anime episodes *@
@if (ViewModel is not null)
{
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!--[if mso]>
        <style type="text/css">
            body, table, td {
                font-family: Arial, Helvetica, sans-serif !important;
            }
        </style>
        <![endif]-->
    </head>
    <body
        style="margin: 0; padding: 0; background-color: #f4f4f5; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;">
    <!-- Email Container -->
    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%"
           style="background-color: #f4f4f5;">
        <tr>
            <td style="padding: 20px 0;">
                <!-- Main Content Container -->
                <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="600"
                       style="margin: 0 auto; background-color: #ffffff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">

                    <!-- Header -->
                    <tr>
                        <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 8px 8px 0 0; text-align: center;">
                            <h1 style="margin: 0; color: #ffffff; font-size: 24px; font-weight: 600; letter-spacing: -0.5px;">
                                ðŸŽ¬ New Episodes Available
                            </h1>
                            <p style="margin: 8px 0 0 0; color: #f0f0f0; font-size: 14px;">
                                @DateTime.Today.ToString("MMMM dd, yyyy")
                            </p>
                        </td>
                    </tr>

                    <!-- Greeting -->
                    <tr>
                        <td style="padding: 24px 30px 16px;">
                            <p style="margin: 0; color: #18181b; font-size: 16px; line-height: 1.5;">
                                Hi <strong>@ViewModel.UserName</strong>,
                            </p>
                            <p style="margin: 8px 0 0 0; color: #52525b; font-size: 14px; line-height: 1.6;">
                                You have
                                <strong style="color: #667eea;">@ViewModel.TotalEpisodeCount new
                                    episode@(ViewModel.TotalEpisodeCount != 1 ? "s" : "")</strong> available to download
                                from
                                your subscriptions.
                            </p>
                        </td>
                    </tr>

                    <!-- Anime List -->
                    <tr>
                        <td style="padding: 0 30px 24px;">
                            @foreach (var anime in ViewModel.AnimeFeeds)
                            {
                                <!-- Anime Card -->
                                <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%"
                                       style="margin-bottom: 20px; border: 1px solid #e4e4e7; border-radius: 6px; overflow: hidden;">
                                    <!-- Anime Title Bar -->
                                    <tr>
                                        <td style="background-color: #fafafa; padding: 12px 16px; border-bottom: 1px solid #e4e4e7;">
                                            <h2 style="margin: 0; color: #18181b; font-size: 16px; font-weight: 600;">
                                                @anime.Title
                                            </h2>
                                            <p style="margin: 4px 0 0 0; color: #71717a; font-size: 12px;">
                                                @anime.Episodes.Length episode@(anime.Episodes.Length != 1 ? "s" : "")
                                            </p>
                                        </td>
                                    </tr>

                                    <!-- Episodes -->
                                    @foreach (var episode in anime.Episodes.OrderByDescending(e => e.EpisodeNumber))
                                    {
                                        <tr>
                                            <td style="padding: 14px 16px; border-bottom: 1px solid #f4f4f5;">
                                                <table role="presentation" cellspacing="0" cellpadding="0" border="0"
                                                       width="100%">
                                                    <tr>
                                                        <td style="vertical-align: middle;">
                                                            <div
                                                                style="display: inline-block; background-color: #667eea; color: #ffffff; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 600; margin-right: 8px;">
                                                                EP @episode.EpisodeNumber
                                                            </div>
                                                            @if (episode.IsNew)
                                                            {
                                                                <span
                                                                    style="display: inline-block; background-color: #22c55e; color: #ffffff; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600;">
                                                                    NEW
                                                                </span>
                                                            }
                                                        </td>
                                                        <td style="text-align: right; vertical-align: middle; white-space: nowrap;">
                                                            <a href="@episode.MagnetLink"
                                                               style="display: inline-block; color: #667eea; text-decoration: none; font-size: 13px; font-weight: 500; margin-right: 12px; padding: 6px 12px; border: 1px solid #667eea; border-radius: 4px; transition: background-color 0.2s;">
                                                                ðŸ§² Magnet
                                                            </a>
                                                            <a href="@episode.TorrentLink"
                                                               style="display: inline-block; color: #667eea; text-decoration: none; font-size: 13px; font-weight: 500; padding: 6px 12px; border: 1px solid #667eea; border-radius: 4px; transition: background-color 0.2s;">
                                                                ðŸ“¥ Torrent
                                                            </a>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    }
                                </table>
                            }
                        </td>
                    </tr>

                    <!-- Footer Message -->
                    <tr>
                        <td style="padding: 0 30px 24px;">
                            <div
                                style="background-color: #fafafa; padding: 16px; border-radius: 6px; border-left: 4px solid #667eea;">
                                <p style="margin: 0; color: #52525b; font-size: 13px; line-height: 1.5;">
                                    ðŸ’¡ <strong>Tip:</strong> Click the Magnet link to start downloading directly in your
                                    torrent client, or use the Torrent link to download the .torrent file first.
                                </p>
                            </div>
                        </td>
                    </tr>

                    <!-- Footer -->
                    <tr>
                        <td style="padding: 20px 30px; background-color: #fafafa; border-radius: 0 0 8px 8px; border-top: 1px solid #e4e4e7;">
                            <p style="margin: 0; color: #71717a; font-size: 12px; text-align: center; line-height: 1.5;">
                                You're receiving this email because you subscribed to these series.<br/>
                            </p>
                            <p style="margin: 12px 0 0 0; color: #a1a1aa; font-size: 11px; text-align: center;">
                                Anime Feed Manager &copy; @DateTime.Today.Year
                            </p>
                        </td>
                    </tr>

                </table>
            </td>
        </tr>
    </table>
    </body>
    </html>
}

@code {
    [Parameter] public NotificationModel? ViewModel { get; set; }

    public static RenderFragment AsRenderFragment(NotificationModel viewModel) => builder =>
    {
        builder.OpenComponent<NotificationEmail>(0);
        builder.AddAttribute(1, nameof(ViewModel), viewModel);
        builder.CloseComponent();
    };

}
